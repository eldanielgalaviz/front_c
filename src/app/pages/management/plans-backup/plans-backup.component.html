<section class="m-1">

    <div class="flex justify-content-center">
        <p-scrollPanel [style]="{ width: '100%', height: '800px' }">
          <div class="flex justify-content-between mb-5">
            <div class="text-2xl text-900">{{proyectoSelected?.ProjectName}}</div>
            <div class="text-lg text-900"></div>
            <!-- <div class="text-lg text-900">Inicio: 2024-11-09 - Fin: 2025-11-09</div> -->
          </div>
          <div class="flex justify-content-center mb-5">
            <div class="text-2xl text-900">Actividades de Reporte</div>
          </div>
          <div class="flex justify-content-center mb-5">
            <p-table [value]="activitiesSchedule" [loading]="loading" [rows]="10" scrollHeight="400px" [tableStyle]="{ 'min-width': '50rem' }"
            [rowsPerPageOptions]="[10, 25, 50]">
            <ng-template pTemplate="header">
                <tr>
                    <th>No.</th>
                    <th>Actividad</th>
                    <th>Descripción</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-customer let-rowIndex="rowIndex">
                <tr>
                  <td>{{rowIndex + 1}}</td>
                  <td>{{ customer.projectsactivities }}</td>
                  <td>{{customer.objetivo}}</td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <p>Without Activities</p>
            </ng-template>
          </p-table>
          </div>
          <div class="flex justify-content-center mb-5">
            <div class="text-2xl text-900">Cronograma de actividades</div>
          </div>
          <div class="flex justify-content-center">
            <p-table [value]="activitiesSchedule" [loading]="loading" [rows]="10" scrollHeight="400px" [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '50rem' }"
              [rowsPerPageOptions]="[10, 25, 50]">
                <ng-template pTemplate="header">
                    <tr>
                        <th>SOP</th>
                        <th>Activity</th>
                        <th>Budget (USD)</th>
                        <th *ngFor="let mes of mesesDelAno">{{mes}}</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-customer>
                    <tr>
                        <td>{{ customer.SOPdescription }}</td>
                        <td>{{ customer.Actividad }}</td>
                        <td>{{ customer.EstimadoUSD | currency }}</td>
                        <td *ngFor="let mes of mesesDelAno;" [ngStyle]="{'background-color': getMonthBackgroundCell(customer.actividaddatestart, customer.actividaddateend, mes),'color':'#FFFFFF'}"></td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="footer">
                  <tr>
                    <td></td>
                    <td>Total:</td>
                    <td class="text-right"> {{sumTotalsByActivities(activitiesSchedule) | currency}}</td>
                  </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <p>Without Activities</p>
                </ng-template>
            </p-table>
          </div>
          <div class="mt-5" *ngFor="let activity of actividadesHist; let i = index">
              <div class="flex justify-content-between mb-5">
                  <div class="text-2xl text-900">Actividad {{i+1}} - {{activity.Actividad}}</div>
                  <div class="text-lg text-900">{{activity.actividaddatestart | date}} - {{activity.actividaddateend | date}}</div>
              </div>
              <p-table styleClass="p-datatable-gridlines">
                <ng-template pTemplate="footer">
                  <tr>
                    <td class="bg-primary">Objetivo</td>
                    <td>{{activity.objetivo}}</td>
                  </tr>
                  <tr>
                    <td class="bg-primary">Metodología</td>
                    <td>{{activity.SOPdescription}}</td>
                  </tr>
                  <tr>
                    <td class="bg-primary">Periodo de ejecución</td>
                    <td>{{activity.actividaddatestart | date:'longDate'}} - {{activity.actividaddateend | date:'longDate'}}</td>
                  </tr>
                  <tr>
                    <td class="bg-primary">Presupuesto de actividad (USD)</td>
                    <td>{{activity.EstimadoUSD | currency}}</td>
                  </tr>
                  <tr>
                    <td class="bg-primary">Indicadores</td>
                    <td>
                      <div class="flex justify-content-start mb-1">
                        <div class="text-lg text-900">Cualitativos</div>
                      </div>
                      <div>
                        {{activity.Cualitativos}}
                      </div>
                      <div class="flex justify-content-start mb-5">
                      </div>
                      <div class="text-lg text-900">Cuantitativos</div>
                      <ul *ngIf="indicadoresCuantitativos[activity.IdActividaddata]; else loading" [innerHTML]="indicadoresCuantitativos[activity.IdActividaddata]"></ul>
                      <ng-template #loading>
                        Cargando indicadores...
                      </ng-template>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3" class="bg-primary">
                      <div class="flex justify-content-center">
                        <strong>Reporteo</strong>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3">
                      <div class="flex justify-content-between mb-3">
                        <div><strong>¿Quién?</strong></div>
                        <div><strong>¿Cómo?</strong></div>
                        <div><strong>¿Cuándo?</strong></div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="3" *ngIf="reporteo[activity.IdActividaddata]; else loading" [innerHTML]="reporteo[activity.IdActividaddata]"></td>
                  </tr>
                  <!-- <ng-template #loadingRep>
                    Cargando indicadores...
                  </ng-template> -->
                  <tr>
                    <td colspan="2">
                      <div class="mt-2">
                        <p-table styleClass="p-datatable-gridlines">
                          <ng-template pTemplate="footer">
                            <tr>
                              <td class="bg-primary" rowspan="5">Roles para realizar actividad</td>
                              <td>Seguimiento</td>
                              <td>{{activity.IDUserSeguimiento}}</td>
                            </tr>
                            <tr>
                              <td>Coordinador</td>
                              <td>{{activity.IDUserCoordinador}}</td>
                            </tr>
                            <tr>
                              <td>Ejecutor de campo</td>
                              <td>{{activity.UserEjecutordeCampo}}</td>
                            </tr>
                            <tr>
                              <td>Supervisor</td>
                              <td>{{activity.UserSupervisor}}</td>
                            </tr>
                            <tr>
                              <td>Evaluador</td>
                              <td>{{activity.IDUserEvaluador}}</td>
                            </tr>
                          </ng-template>
                        </p-table>
                      </div>
                      <div class="mt-2">
                        Mapa de ubicación geográfica
                        <div class="flex justify-content-center">
                          <img *ngIf="activity.linkdelarchivo" [src]="url + activity.linkdelarchivo" width="500" height="400">
                          <small *ngIf="!activity.linkdelarchivo">Sin imagen previa</small>
                        </div>
                      </div>
                    </td>
                  </tr>
                </ng-template>
            </p-table>
          </div>
        </p-scrollPanel>
      </div>
</section>