<p-sidebar appendTo="body" [(visible)]="sidebarVisible" [style]="{'width': '30rem'}" position="right">
    <h3>Monitoring of activities by Project</h3>
    <p>
        This view have a 4 sections <br>
        <li>Budget Tracker</li>
        <li>Schedules</li>
        <li>KPI Monitor</li>
        <li>Dates</li>
        If you want make a new Activity, please Click in "Report Activities" <br>
        After create your Report, you can see the new register and follow the progress.
    </p>

</p-sidebar>
<section class="m-5">
    <div class="flex justify-content-between m-5">
        <div class="text-2xl text-900">Monitoring Activities by Project</div>
        <div>
            <p-button icon="pi pi-pencil" label="Report Activities" class="p-button-rounded p-button-success mr-2" routerLink="/Monitor-activities-create"></p-button>
            <p-button type="button" styleClass="p-button-success ml-2" pTooltip="Info" tooltipPosition="bottom" (click)="sidebarVisible = true" icon="pi pi-info-circle"></p-button>
        </div>
    </div>

    <p-tabView>
        <p-tabPanel header="Schedules">
            <div>
                <p-table [value]="ActivitiesDates" [rows]="50" scrollHeight="400px"  [tableStyle]="{ 'min-width': '50rem' }">
                    <ng-template pTemplate="caption">
                        <div class="flex justify-content-between">
                            <div>
                                <span class="p-float-label">
                                    <p-dropdown appendTo="body" [(ngModel)]="rpSelected" [options]="rpnumbers" placeholder="Select RP" optionLabel="RP_Number" optionValue="idrpnumber" [autoDisplayFirst]="true" (ngModelChange)="changeRP()"></p-dropdown>
                                    <label for="">Select RP</label>
                                </span>
                            </div>
                            <span class="m-2"><strong>Planned Schedule: </strong></span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Activity</th>
                            <th *ngFor="let mes of mesesDelAno">{{mes}}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer>
                        <tr>
                            <td>{{ customer.NombreActividad || customer.nombreactividad }}</td>
                            <td *ngFor="let mes of mesesDelAno;" [ngStyle]="{'background-color': getMonthBackgroundCell(customer.actividaddatestart, customer.actividaddateend, mes),'color':'#FFFFFF'}"></td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7">No activities found.</td>
                        </tr>
                    </ng-template>
                </p-table>
                <p-divider></p-divider>
                <p-table [value]="ActivitiesDates" [rows]="50" scrollHeight="400px"  [tableStyle]="{ 'min-width': '50rem' }">
                    <ng-template pTemplate="caption">
                        <div class="flex justify-content-end">
                            <span class="m-2"><strong>Actual Schedule: </strong></span>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Activity</th>
                            <th *ngFor="let mes of mesesDelAno">{{mes}}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-customer>
                        <tr>
                            <td>{{ customer.NombreActividad || customer.nombreactividad }}</td>
                            <td *ngFor="let mes of mesesDelAno;" [ngStyle]="{'background-color': getMonthBackgroundCell(customer.StartDateActual, customer.EndDateActual, mes),'color':'#FFFFFF'}"></td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7">No activities found.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-tabPanel>
        <p-tabPanel header="KPI Monitor">
            <p-table #dt1 [loading]="loading" paginatorDropdownAppendTo="body" dataKey="IdActividaddata" [value]="ActivityPlan" [paginator]="true" [rows]="10" [paginator]="true" [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '50rem' }"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [rowsPerPageOptions]="[10, 25, 50]" [globalFilterFields]="['IdActividaddata','Actividad', 'StatusName']">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between">
                    <div>
                        <span class="p-float-label">
                            <p-dropdown appendTo="body" [(ngModel)]="rpSelected" [options]="rpnumbers" placeholder="Select RP" optionLabel="RP_Number" optionValue="idrpnumber" [autoDisplayFirst]="true" (ngModelChange)="changeRP()"></p-dropdown>
                            <label>Select RP</label>
                        </span>
                    </div>
                    <div>
                        <span class="p-input-icon-left ml-auto">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" (input)="handleGlobalFilter($event)" placeholder="Search..." />
                        </span>
                        <p-button label="Download SDG report" styleClass="p-button-outlined" class="m-1" icon="pi pi-file-excel"></p-button>
                        <p-button label="Download KPI report" (onClick)="exportKPIToExcel()" styleClass="p-button-outlined" class="m-1" icon="pi pi-file-excel"></p-button>
                        <p-button label="Download general KPI report" (onClick)="exportGeneralReport()" styleClass="p-button-outlined" class="m-1" icon="pi pi-file-excel"></p-button>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 5rem"></th>
                    <th pSortableColumn="IdActividaddata">ID<p-sortIcon field="IdActividaddata"></p-sortIcon></th>
                    <th pSortableColumn="Actividad">Activity<p-sortIcon field="Actividad"></p-sortIcon></th>
                    <th pSortableColumn="StatusName">Status <p-sortIcon field="StatusName"></p-sortIcon></th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-activity let-expanded="expanded">
                <tr>
                    <td>
                        <button type="button" pButton pRipple [pRowToggler]="activity" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
                    </td>
                    <td>{{ activity.IdActividaddata }}</td>
                    <td>{{ activity.Actividad }}</td>
                    <td>
                        <span *ngIf="activity.IdstatusReporteoActividades == 1" class="status-pending"><strong>{{activity.StatusName}}</strong></span>
                        <span *ngIf="activity.IdstatusReporteoActividades == 2" class="status-evaluation"><strong>{{activity.StatusName}}</strong></span>
                        <span *ngIf="activity.IdstatusReporteoActividades == 3" class="status-finished"><strong>{{activity.StatusName}}</strong></span>
                    </td>
                    <td><p-button icon="pi pi-eye"  [routerLink]="['/Monitor-activities-edit', rpSelected, activity.IdActividaddata]" class="p-button-rounded p-button-success mr-2"></p-button></td>
                </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-reporting>
                <tr>
                    <td colspan="4">
                        <div class="p-3">
                            <p-table [value]="reporting.reporting" dataKey="IdActividaddata" [paginator]="true" [rows]="5" [paginator]="true" 
                                     currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [rowsPerPageOptions]="[5, 10, 25]">
                                <ng-template pTemplate="header">
                                    <tr>
                                        <th>Indicator</th>
                                        <th>KPI</th>
                                        <th>Quantity Goal</th>
                                        <th>Quantity to Date</th>
                                        <th>Progress</th>
                                        <th>Part Woman</th>
                                        <th>Part Man</th>
                                        <th>Jobs benefits</th>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="body" let-report>
                                    <tr>
                                        <td>{{ report.cuantitativo }}</td>
                                        <td>{{ report.Metrica }}</td>
                                        <td>{{ report.estimado }}</td>
                                        <td>{{ report.AvanceCuantitativo }}</td>
                                        <td>{{ report.calculatedprogress }}%</td>
                                        <td>{{ report.participatingW }}</td>
                                        <td>{{ report.participatingM }}</td>
                                        <td>{{ report.NumJornales }}</td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="emptymessage">
                                    <tr>
                                        <td colspan="8">There are no order for this product yet.</td>
                                    </tr>
                                </ng-template>
                            </p-table>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">No activities found.</td>
                </tr>
            </ng-template>
            <!-- <ng-template pTemplate="header">
                <tr>
                    <th>Activity</th>
                    <th>Indicator</th>
                    <th>KPI</th>
                    <th>Quantity Goal</th>
                    <th>Quantity to Date</th>
                    <th>Progress</th>
                    <th>Part Woman</th>
                    <th>Part Man</th>
                    <th>Jobs benefits</th>
                    <th>Status</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-customer>
                <tr>
                    
                    
                    
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7">No activities found.</td>
                </tr>
            </ng-template> -->
            </p-table>
        </p-tabPanel>
        <p-tabPanel header="Dates">
            <p-table paginatorDropdownAppendTo="body" [value]="ActivitiesDates" [paginator]="true" styleClass="p-datatable-gridlines" [rows]="10" scrollHeight="400px" [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '50rem' }"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [rowsPerPageOptions]="[10, 25, 50]">
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between">
                        <div>
                            <span class="p-float-label">
                                <p-dropdown appendTo="body" [(ngModel)]="rpSelected" [options]="rpnumbers" placeholder="Select RP" optionLabel="RP_Number" optionValue="idrpnumber" [autoDisplayFirst]="true" (ngModelChange)="changeRP()"></p-dropdown>
                                <label for="">Select RP</label>
                            </span>
                        </div>
                        <div>
                            <p-button label="Download XLSX file" (onClick)="exportDatesToExcel()" styleClass="p-button-outlined" class="m-1" icon="pi pi-file-excel"></p-button>
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr class="backgroundtable">
                        <th>Activity</th>
                        <th>Start Date Planned</th>
                        <th>End Date Planned</th>
                        <th>Start Date Actual</th>
                        <th>End Date Actual</th>
                        <th>Start Delayed</th>
                        <th>End Delayed</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-customer>
                    <tr>
                        <td>{{ customer.nombreactividad }}</td>
                        <td>{{ customer.actividaddatestart | date: 'dd/MM/yyyy': 'UTC' }}</td>
                        <td>{{ customer.actividaddateend | date: 'dd/MM/yyyy': 'UTC' }}</td>
                        <td>{{ customer.StartDateActual | date: 'dd/MM/yyyy': 'UTC' }}</td>
                        <td>{{ customer.EndDateActual | date: 'dd/MM/yyyy': 'UTC' }}</td>
                        <td>{{ customer.StartDelayed }}</td>
                        <td>{{ customer.EndDelayed }}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7">No activities found.</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-tabPanel>
    </p-tabView>
</section>
